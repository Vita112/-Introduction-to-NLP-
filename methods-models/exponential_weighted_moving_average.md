## 一、EMA简介
   算数平均（权重相等）→加权平均（权重不等）→移动平均（约等于 取最近的N次数据进行计算）
→批量归一化(BN)及各种优化算法基础
    
+ EMA：**以指数式递减加权 的移动平均，各数值的加权影响力 随时间呈现指数式递减，时间越靠近当前时刻的数据，其加权影响力越大**。可以通过计算局部的平均值，来描述熟知的变化趋势。exponentially weighted averages公式如下：

$$V_{t}=\beta V_{t-1}+(1-\beta )\theta \_{t}$$

**以下使用温度的局部平均值来描述温度的变化趋势，结合上述公式计算局部平均值**：
> 1. $V_{t}$ 代表t时刻的局部平均值，$\theta \_{t}$表示t时刻的实际温度，*系数β表示加权下降的快慢，值越小权重下降得越快，可理解为 梯度变化快，反映为 函数方差大，上下波动更剧烈*。以下3个图分别是 β=0.9，β=0.98和β=0.5时，天数与温度的变化趋势对比图：

+ β=0.9时，Vt可以看做是1/(1-β)=10天的平均值，此时温度趋势图如下：

![β_0.9]()

+ β=0.98 时，Vt可以看做是1/(1-β)=50 天的平均值，此时温度趋势图如下：

![β_0.98]()

+ β=0.5 时，Vt可以看做是1/(1-β)=2 天的平均值，此时温度趋势图如下：

![β_0.5]()

观察可以发现：越小的β值，其气温曲线波动更剧烈，因此对于温度变化的反馈也更加及时，只是，它同时也带来更多的噪声。也就是说，**系数β的值越小，t时刻的局部平均值更容易受到干扰，因此波动更大**。
> 2. 当t=100,β=0.9 时，指数加权平均公式展开如下：

$$V_{100}=0.1\ast  \theta \_{100}+0.1\ast 0.9\ast \theta \_{99}+0.1\ast 0.9^{2}\ast \theta \_{98}+\cdots +0.1\ast 0.9^{99}\ast \theta \_{1}\\\\
=0.1\ast \sum_{i=1}^{99}0.9^{100-i}\ast \theta \_{i}$$

*使用指数加权平均 来计算局部平均值时，可节省大量空间，你只需要保存前一个加权平均值*。

当V0=0时，上述公式$V_{t}=\beta V_{t-1}+(1-\beta )\theta \_{t}$可表示为 
$$V_{t}=(1-\beta )(\theta \_{t}+\beta \theta \_{t-1}+\beta ^{2}\theta \_{t-2}+\cdots +\beta ^{t-1}\theta \_{1})$$
观察上式，可以发现：每天的温度Θ 的权重系数β `以指数等比形式` 缩小,

`因$1+\beta +\beta ^{2}+\cdots +\beta ^{t-1}=\frac{1-\beta ^{t}}{1-\beta }$,优化算法中，β一般取值≥0.9，当t足够大时，$\beta ^{t}\approx 0$.`

此时，有$\beta ^{\frac{1}{1-\beta }}\approx \frac{1}{e}\approx 0.36$也就是说：在$N=\frac{1}{1-\beta }$后，曲线相对于之前产生1/3的波动。由于时间越往前推移，t时刻温度Θ的权重将越来越小，这相当于每次只考虑最近的$N=\frac{1}{1-\beta }$天的数据，来计算t时刻局部平均值。而时间越靠近当前时刻的数据，其加权影响力越大。

## 二、EMA Bias correction偏差修正-主要针对前期的局部平均值误差
当β=0.98，V0=0时，温度曲线不能很好地估计起始位置的温度，这被称为**冷启动问题**。

**解决方案**

通过将Vt除以$1-\beta ^{t}$来修正指数加权平均的误差，于是$$V_{t}=\frac{V_{t}}{1-\beta ^{t}}$$
随着t的增大，$1-\beta ^{t}$会趋于1，故bias correction对后期的指数加权平均没有影响。
